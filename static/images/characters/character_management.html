{% extends "base.html" %}

{% block title %}角色管理 - AI角色扮演{% endblock %}

{% block content %}
<div style="padding: 50px 0;">
    <div class="container">
        <div style="margin-bottom: 30px;">
            <h2 style="color: white;">角色管理</h2>
            <a href="/" class="btn btn-outline-light">返回首页</a>
        </div>

        <!-- 添加角色按钮 -->
        <div style="margin-bottom: 30px;">
            <a href="#add-form" class="btn btn-primary">+ 添加新角色</a>
        </div>

        <!-- 角色列表 -->
        <div class="row">
            {% for character in characters %}
            <div class="col-md-4 mb-4">
                <div class="card">
                    <img src="{{ character.avatar }}" class="card-img-top" style="height: 200px; object-fit: cover;" alt="{{ character.name }}">

                    <div class="card-body">
                        <h5 class="card-title">
                            {{ character.name }}
                            {% if character.id in ['harry_potter', 'sherlock_holmes', 'confucius', 'marie_curie', 'sun_wukong', 'einstein', 'mulan', 'elizabeth_bennet'] %}
                            <span class="badge bg-warning text-dark">默认角色</span>
                            {% endif %}
                        </h5>
                        <p class="card-text">{{ character.description }}</p>
                        <p>
                            <span class="badge bg-primary">{{ character.category }}</span>
                            <span class="badge bg-secondary">{{ character.skills|length }} 技能</span>
                        </p>

                        <div style="margin-top: 15px;">
                            <a href="{{ url_for('character_detail', character_id=character.id) }}" class="btn btn-sm btn-outline-primary">查看详情</a>

                            {% if character.id not in ['harry_potter', 'sherlock_holmes', 'confucius', 'marie_curie', 'sun_wukong', 'einstein', 'mulan', 'elizabeth_bennet'] %}
                            <form method="POST" action="/api/characters/{{ character.id }}/delete" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('确定要删除角色 {{ character.name }} 吗？')">删除</button>
                            </form>
                            {% else %}
                            <button class="btn btn-sm btn-secondary" disabled>默认角色</button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- 添加角色表单 -->
        <div id="add-form" style="margin-top: 50px; background: white; padding: 30px; border-radius: 15px;">
            <h3 style="margin-bottom: 20px;">添加新角色</h3>

            <form method="POST" action="/api/characters/create" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="name" class="form-label">角色名称 *</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>

                <div class="mb-3">
                    <label for="description" class="form-label">简短描述 *</label>
                    <input type="text" class="form-control" id="description" name="description" required>
                </div>

                <div class="mb-3">
                    <label for="category" class="form-label">角色类别 *</label>
                    <select class="form-select" id="category" name="category" required>
                        <option value="">请选择类别</option>
                        {% for category in categories %}
                        <option value="{{ category }}">{{ category }}</option>
                        {% endfor %}
                        <option value="other">其他</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="personality" class="form-label">性格特点 *</label>
                    <textarea class="form-control" id="personality" name="personality" rows="3" required placeholder="例如：聪明机智、独立自主、富有幽默感"></textarea>
                </div>

                <div class="mb-3">
                    <label for="background" class="form-label">背景故事 *</label>
                    <textarea class="form-control" id="background" name="background" rows="3" required placeholder="角色的来历、经历、成就等"></textarea>
                </div>

                <div class="mb-3">
                    <label for="greeting" class="form-label">问候语 *</label>
                    <textarea class="form-control" id="greeting" name="greeting" rows="2" required placeholder="角色初次见面时的自我介绍"></textarea>
                </div>

                <div class="mb-3">
                    <label for="skills" class="form-label">专业技能（逗号分隔）</label>
                    <input type="text" class="form-control" id="skills" name="skills" placeholder="例如：魔法知识, 推理, 战斗技巧">
                </div>

                <div class="mb-3">
                    <label for="avatar_file" class="form-label">角色头像</label>
                    <input type="file" class="form-control" id="avatar_file" name="avatar_file" accept="image/*">
                    <small class="text-muted">如不上传，将使用默认头像</small>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="gender" class="form-label">性别</label>
                        <select class="form-select" id="gender" name="gender">
                            <option value="female">女性</option>
                            <option value="male">男性</option>
                            <option value="neutral">中性</option>
                        </select>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="age" class="form-label">年龄段</label>
                        <select class="form-select" id="age" name="age">
                            <option value="young">年轻</option>
                            <option value="adult">成年</option>
                            <option value="elderly">年长</option>
                        </select>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="temperature_modifier" class="form-label">创造性调节</label>
                        <input type="number" class="form-control" id="temperature_modifier" name="temperature_modifier" value="0" min="-0.5" max="0.5" step="0.1">
                        <small class="text-muted">-0.5到0.5</small>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">创建角色</button>
                    <a href="#" class="btn btn-secondary">取消</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}